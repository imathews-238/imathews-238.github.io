<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Map of Colorado Springs</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="anonymous"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://imathews-238.github.io/CE514/style.css">
</head>
<body>
    <header>
        <h1>Interactive Map Project</h1>
        <p><strong>Name:</strong> Ian</p>
        <p><strong>Assignment:</strong> Interactive Map of my hometown with Leaflet</p>
        <p><strong>Class:</strong> Geospatial Software Development</p>
        <p><strong>Date:</strong> January 27, 2025</p>
    </header>
    <main>
        <div id="map"></div>
        <section id="distance-section">
            <h2>Calculate Distance Between Two Points</h2>
            <form id="distance-form">
                <label for="point1">Point 1 (Latitude, Longitude):</label>
                <input type="text" id="point1" placeholder="e.g., 38.8339, -104.8214" required>
                <label for="point2">Point 2 (Latitude, Longitude):</label>
                <input type="text" id="point2" placeholder="e.g., 38.8339, -104.8000" required>
                <button type="submit">Calculate Distance</button>
            </form>
            <p id="distance-result"></p>
        </section>
    </main>
    <script>
        // Initialize the map and set view to Colorado Springs coordinates
        const map = L.map('map').setView([38.8339, -104.8214], 13);

        // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);

        // Add point markers with popups for Colorado Springs locations
        const locations = [
            { name: "My House", coords: [38.8339, -104.8214] },
            { name: "My School", coords: [38.8462, -104.8007] },
            { name: "My Church", coords: [38.8283, -104.8401] },
            { name: "Garden of the Gods", coords: [38.8783, -104.8691] },
            { name: "Pikes Peak", coords: [38.8409, -105.0423] }
        ];

        locations.forEach(location => {
            L.marker(location.coords).addTo(map).bindPopup(location.name);
        });

        // Add polygon for home property boundaries
        const homeBoundary = [
            [38.8340, -104.8220],
            [38.8340, -104.8208],
            [38.8338, -104.8208],
            [38.8338, -104.8220]
        ];
        L.polygon(homeBoundary, { color: 'blue' }).addTo(map).bindPopup("Home Property");

        // Add circle for 10-minute walking area
        L.circle([38.8339, -104.8214], {
            color: 'green',
            fillColor: '#0f0',
            fillOpacity: 0.5,
            radius: 800 // Roughly 10 minutes walking distance
        }).addTo(map).bindPopup("10-minute Walking Radius");

        // Layer group for dynamically added markers and lines
        const dynamicLayer = L.layerGroup().addTo(map);

        // Distance calculation and great-circle path
        document.getElementById('distance-form').addEventListener('submit', function (e) {
            e.preventDefault();

            const point1 = document.getElementById('point1').value.split(',').map(Number);
            const point2 = document.getElementById('point2').value.split(',').map(Number);

            if (point1.length !== 2 || point2.length !== 2 || isNaN(point1[0]) || isNaN(point1[1]) || isNaN(point2[0]) || isNaN(point2[1])) {
                alert('Please enter valid coordinates.');
                return;
            }

            // Clear previous markers and lines
            dynamicLayer.clearLayers();

            const R = 6371; // Earth's radius in km
            const toRad = deg => deg * Math.PI / 180;

            const [lat1, lon1] = point1.map(toRad);
            const [lat2, lon2] = point2.map(toRad);

            const dLat = lat2 - lat1;
            const dLon = lon2 - lon1;

            const a = Math.sin(dLat / 2) ** 2 + Math.cos(lat1) * Math.cos(lat2) * Math.sin(dLon / 2) ** 2;
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            const distance = R * c;

            document.getElementById('distance-result').textContent = `Distance: ${distance.toFixed(2)} km`;

            // Add markers and line to the map
            L.marker(point1).addTo(dynamicLayer).bindPopup("Point 1").openPopup();
            L.marker(point2).addTo(dynamicLayer).bindPopup("Point 2").openPopup();

            L.polyline([point1, point2], { color: 'red' }).addTo(dynamicLayer).bindPopup(`Distance: ${distance.toFixed(2)} km`);

            // Fit map to bounds of the two points with padding for better visibility
            const bounds = L.latLngBounds([point1, point2]);
            map.fitBounds(bounds, { padding: [100, 100] });
        });
    </script>
</body>
</html>
