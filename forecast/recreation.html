<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colorado River Flow Forecast & Safety</title>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; text-align: center; background-color: #f4f4f4; }
        header { background: #004466; color: white; padding: 20px; font-size: 22px; }
        #description { margin: 15px; padding: 10px; font-size: 16px; max-width: 80%; margin: auto; }
        #map { height: 60vh; width: 80%; margin: 20px auto; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        #controls { margin: 10px; padding: 8px; }
        #forecast-select { padding: 8px; font-size: 16px; }
        #chart-container { width: 80%; margin: 20px auto; background: white; padding: 10px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        #warning { font-size: 18px; font-weight: bold; margin-top: 10px; }
        #legend { display: flex; justify-content: center; gap: 20px; margin: 10px; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-box { width: 20px; height: 20px; display: inline-block; border-radius: 5px; }
        #status-card { width: 80%; margin: 15px auto; padding: 15px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); font-size: 18px; }
        .safe { background: #4CAF50; color: white; }
        .caution { background: #FF9800; color: white; }
        .danger { background: #F44336; color: white; }
        .gauge { width: 100px; height: 100px; border-radius: 50%; margin: auto; border: 10px solid gray; }
    </style>
</head>
<body>

    <header>
        Colorado Recreation River Forecast & Safety
    </header>

    <div id="description">
        <p>
            This web application provides real-time and forecasted river flow data for outdoor recreation and safety in Colorado.
            Users can check rivers to assess **rafting, fishing, and flood risks** in Colorado. Click on a river 
            point to see forecasted flow rates and warnings based on safety thresholds. Flood data is provided by accessing data from the U.S. National Water Model (NWM).
        </p>
    </div>

    <div id="controls">
        <label for="forecast-select">Select Forecast Range:</label>
        <select id="forecast-select">
            <option value="short">Short-Range (Next 24 hrs)</option>
            <option value="medium">Medium-Range (Next 3 days)</option>
            <option value="long">Long-Range (Next 7 days)</option>
        </select>
    </div>

    <!-- Map Section -->
    <div id="map"></div>

    <!-- Flow Level Legend -->
    <div id="legend">
        <div class="legend-item"><span class="legend-box" style="background:#4CAF50;"></span> Safe (1500-4000 CFS)</div>
        <div class="legend-item"><span class="legend-box" style="background:#FF9800;"></span> Caution (800-1500 CFS)</div>
        <div class="legend-item"><span class="legend-box" style="background:#F44336;"></span> Danger (>4000 CFS)</div>
    </div>

    <!-- Status Display -->
    <div id="status-card" class="safe">
        ✅ Select a river point for safety status.
    </div>

    <!-- Mockup Gauge -->
    <div class="gauge"></div>

    <!-- Chart Container -->
    <div id="chart-container">
        <canvas id="flowChart"></canvas>
    </div>

    <script>
        // Initialize Leaflet Map
        var map = L.map('map').setView([39.5501, -105.7821], 8);

        // Add OpenStreetMap Tile Layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Example River Points
        var riverPoints = [
            { name: "Arkansas River", lat: 38.842, lon: -106.133 },
            { name: "Colorado River", lat: 39.368, lon: -107.728 },
            { name: "South Platte River", lat: 40.167, lon: -104.833 }
        ];

        // Function to get marker color
        function getMarkerColor(flow) {
            if (flow > 4000) return "red"; 
            if (flow < 1500) return "orange"; 
            return "green"; 
        }

        // Add Points to Map
        riverPoints.forEach(point => {
            var flowRate = Math.floor(Math.random() * (5000 - 800) + 800);
            var markerColor = getMarkerColor(flowRate);
            var marker = L.circleMarker([point.lat, point.lon], {
                radius: 8,
                fillColor: markerColor,
                color: "#000",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(map)
                .bindPopup(`<b>${point.name}</b><br>Click for flow data`)
                .on('click', function() { updateChart(point.name, flowRate); });
        });

        // Chart.js Setup
        var ctx = document.getElementById('flowChart').getContext('2d');
        var flowChart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'Flow Rate (CFS)', data: [], borderColor: 'blue' }] },
            options: { responsive: true }
        });

        // Function to Update Chart & Status
        function updateChart(riverName, flowRate) {
            var forecastType = document.getElementById('forecast-select').value;
            var flowData = generateMockData(); 

            flowChart.data.labels = flowData.dates;
            flowChart.data.datasets[0].data = flowData.values;
            flowChart.data.datasets[0].label = `${riverName} Flow - ${forecastType}`;
            flowChart.update();

            var statusCard = document.getElementById("status-card");
            if (flowRate > 4000) {
                statusCard.innerHTML = `⚠️ WARNING: Flow at ${riverName} is HIGH! Dangerous conditions.`;
                statusCard.className = "danger";
            } else if (flowRate < 1500) {
                statusCard.innerHTML = `⚠️ Flow at ${riverName} is LOW. Poor conditions.`;
                statusCard.className = "caution";
            } else {
                statusCard.innerHTML = `✅ Flow at ${riverName} is safe for recreation.`;
                statusCard.className = "safe";
            }
        }

        function generateMockData() {
            var dates = [], values = [];
            for (var i = 0; i < 7; i++) {
                dates.push(`Day ${i+1}`);
                values.push(Math.floor(Math.random() * (5000 - 800) + 800));
            }
            return { dates, values };
        }
    </script>

</body>
</html>
